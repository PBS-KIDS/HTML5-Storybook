/*! HTML5-Storybook 1.0.0 */
!function(){"use strict";var WM;WM||(WM={}),WM.drawingCanvas=function(a,b){"use strict";var c,d={},e=b&&b.width?b.width:200,f=b&&b.height?b.height:100,g=b&&b.defaultColor?b.defaultColor:"#993333",h=b&&b.radius?b.radius:5,i="MARKER",j=new Image,k=new Image,l=[],m=[],n=[],o=[],p=[],q=[],r=!1,s=1,t=0,u=function(){c.clearRect(0,0,e,f)},v=function(){var a,d;if(!(s>t)){for(u(),d=0;d<l.length;d+=1)a=p[d],c.beginPath(),q[d]&&d?c.moveTo(l[d-1],m[d-1]):c.moveTo(l[d]-1,m[d]),c.lineTo(l[d],m[d]),"ERASER"===o[d].toUpperCase()?c.globalCompositeOperation="destination-out":(c.globalCompositeOperation="source-over",c.strokeStyle=n[d]),c.lineCap="round",c.lineJoin="round",c.lineWidth=a,c.stroke();c.closePath(),c.globalCompositeOperation="source-over",b.textureUrl&&c.drawImage(j,0,0),b.overlayUrl&&c.drawImage(k,0,0)}},w=function(a,b,c){l.push(a),m.push(b),o.push(i),n.push(g),p.push(h),q.push(c)},x=function(a){var b,c={x:a.offsetLeft,y:a.offsetTop};return a.offsetParent&&(b=x(a.offsetParent),c.x+=b.x,c.y+=b.y),c},y=function(){var a=function(a){var b,c,d=x(this),g=a.targetTouches?a.targetTouches[0].pageX:a.pageX,h=a.targetTouches?a.targetTouches[0].pageY:a.pageY;b=(g-d.x)*e/this.offsetWidth,c=(h-d.y)*f/this.offsetHeight,r=!0,w(b,c,!1),v()},b=function(a){var b,c,d=x(this),g=a.targetTouches?a.targetTouches[0].pageX:a.pageX,h=a.targetTouches?a.targetTouches[0].pageY:a.pageY;b=(g-d.x)*e/this.offsetWidth,c=(h-d.y)*f/this.offsetHeight,r&&(w(b,c,!0),v()),a.stopPropagation(),a.preventDefault()},c=function(){r=!1,v()},g=function(){r=!1};d.canvas.addEventListener("mousedown",a,!1),d.canvas.addEventListener("mousemove",b,!1),d.canvas.addEventListener("mouseup",c,!1),d.canvas.addEventListener("mouseout",g,!1),d.canvas.addEventListener("touchstart",a,!1),d.canvas.addEventListener("touchmove",b,!1),d.canvas.addEventListener("touchend",c,!1),d.canvas.addEventListener("touchcancel",g,!1)},z=function(){t+=1,t===s&&(v(),y())},A=function(){void 0!==b.width&&(e=b.width),void 0!==b.height&&(f=b.height),d.canvas=document.createElement("canvas"),d.canvas.setAttribute("width",e),d.canvas.setAttribute("height",f),d.canvas.setAttribute("class","drawingCanvas"),a.appendChild(d.canvas),"undefined"!=typeof G_vmlCanvasManager&&(d.canvas=G_vmlCanvasManager.initElement(d.canvas)),c=d.canvas.getContext("2d"),b.overlayUrl&&(s+=1,k.onload=z,k.src=b.overlayUrl),b.textureUrl&&(s+=1,j.onload=z,j.src=b.textureUrl),z()};return d.canvas=null,d.render=function(){v()},d.setColor=function(a){g=a},d.setSize=function(a){h=a},d.setTool=function(a){"MARKER"===a.toUpperCase()?i="MARKER":"ERASER"===a.toUpperCase()&&(i="ERASER")},d.clear=function(){l=[],m=[],n=[],o=[],p=[],q=[],u(),v()},A(),d};}();